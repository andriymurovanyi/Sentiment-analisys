import json
from string import ascii_lowercase
from preprocess import DataExtractor
import re
import emoji


class Parser:
    """
    Class which using to parse telegram data.
    """
    extractor = DataExtractor("result.json")
    data = extractor.result_data

    def __init__(self):
        self.__chats = []

        self.__messages = []

        self.extract_info()

    def extract_info(self):
        for i in range(len(Parser.data)):
            chat_name = Parser.data[i]['name']
            chat_type = Parser.data[i]['type']
            chat_id = Parser.data[i]['id']
            self.__chats.append((chat_name, chat_type, chat_id))
            tmp_messages = Parser.data[i]['messages']
            tmp_arr = []
            try:
                for j in range(len(tmp_messages)):
                    sender = tmp_messages[j]['from']
                    sender_id = tmp_messages[j]['from_id']
                    date, time = tmp_messages[j]['date'].split("T")
                    text = tmp_messages[j]['text']
                    tmp_arr.append((sender, sender_id, date, time, text))
                if len(tmp_arr) > 0:
                    self.__messages.append(tmp_arr)
            except KeyError:
                continue

    @property
    def messages(self):
        return self.__messages

    @property
    def chats(self):
        return self.__chats


# if __name__ == '__main__':
#      l ={'name': 'Лена', 'type': 'personal_chat', 'id': 4610503777, 'messages': [{'id': 138, 'type': 'message', 'date': '2018-12-25T23:40:10', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Кусь'}, {'id': 144, 'type': 'message', 'date': '2018-12-25T23:57:56', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'photo': '(File not included. Change data exporting settings to download.)', 'width': 720, 'height': 1280, 'text': ''}, {'id': 145, 'type': 'message', 'date': '2018-12-25T23:57:59', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Це я мав тут бути'}, {'id': 203, 'type': 'message', 'date': '2018-12-26T00:18:26', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'text': 'Ахах'}, {'id': 204, 'type': 'message', 'date': '2018-12-26T00:18:38', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'file': '(File not included. Change data exporting settings to download.)', 'media_type': 'voice_message', 'mime_type': 'audio/ogg', 'duration_seconds': 2, 'text': ''}, {'id': 205, 'type': 'message', 'date': '2018-12-26T00:18:42', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'file': '(File not included. Change data exporting settings to download.)', 'media_type': 'voice_message', 'mime_type': 'audio/ogg', 'duration_seconds': 2, 'text': ''}, {'id': 206, 'type': 'message', 'date': '2018-12-26T00:18:48', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'file': '(File not included. Change data exporting settings to download.)', 'media_type': 'voice_message', 'mime_type': 'audio/ogg', 'duration_seconds': 4, 'text': ''}, {'id': 207, 'type': 'message', 'date': '2018-12-26T00:37:44', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Ну вот'}, {'id': 208, 'type': 'message', 'date': '2018-12-26T00:37:50', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Я теж такої думки)'}, {'id': 209, 'type': 'message', 'date': '2018-12-26T00:37:53', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Я здись'}, {'id': 217, 'type': 'message', 'date': '2018-12-26T00:46:56', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'text': 'Ага'}, {'id': 218, 'type': 'message', 'date': '2018-12-26T00:54:42', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'file': '(File not included. Change data exporting settings to download.)', 'media_type': 'voice_message', 'mime_type': 'audio/ogg', 'duration_seconds': 47, 'text': ''}, {'id': 219, 'type': 'message', 'date': '2018-12-26T00:55:16', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'file': '(File not included. Change data exporting settings to download.)', 'media_type': 'voice_message', 'mime_type': 'audio/ogg', 'duration_seconds': 2, 'text': ''}, {'id': 220, 'type': 'message', 'date': '2018-12-26T23:15:16', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'text': 'а тут є?'}, {'id': 221, 'type': 'message', 'date': '2018-12-26T23:20:03', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Є'}, {'id': 222, 'type': 'message', 'date': '2018-12-26T23:22:51', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'photo': '(File not included. Change data exporting settings to download.)', 'width': 720, 'height': 1280, 'text': ''}, {'id': 223, 'type': 'message', 'date': '2018-12-26T23:22:51', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'photo': '(File not included. Change data exporting settings to download.)', 'width': 720, 'height': 1280, 'text': ''}, {'id': 224, 'type': 'message', 'date': '2018-12-26T23:23:43', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'file': '(File not included. Change data exporting settings to download.)', 'media_type': 'voice_message', 'mime_type': 'audio/ogg', 'duration_seconds': 49, 'text': ''}, {'id': 225, 'type': 'message', 'date': '2018-12-26T23:23:59', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'А, в тебе теж підняли'}, {'id': 226, 'type': 'message', 'date': '2018-12-26T23:24:00', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Ппц'}, {'id': 227, 'type': 'message', 'date': '2018-12-26T23:24:13', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'В мене 115'}, {'id': 228, 'type': 'message', 'date': '2018-12-26T23:24:18', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': '7 гб'}, {'id': 229, 'type': 'message', 'date': '2018-12-26T23:24:20', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': '700 хв'}, {'id': 230, 'type': 'message', 'date': '2018-12-26T23:24:36', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'reply_to_message_id': 223, 'text': 'Цей, до речі недоступний'}, {'id': 231, 'type': 'message', 'date': '2018-12-26T23:24:45', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'file': '(File not included. Change data exporting settings to download.)', 'media_type': 'voice_message', 'mime_type': 'audio/ogg', 'duration_seconds': 13, 'text': ''}, {'id': 232, 'type': 'message', 'date': '2018-12-26T23:24:58', 'edited': '2018-12-26T23:25:01', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Піздец'}, {'id': 233, 'type': 'message', 'date': '2018-12-26T23:25:12', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'А на Київ вертатися не хочу'}, {'id': 234, 'type': 'message', 'date': '2018-12-26T23:25:51', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'В мене вже все було'}, {'id': 235, 'type': 'message', 'date': '2018-12-26T23:25:54', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'І мтс'}, {'id': 236, 'type': 'message', 'date': '2018-12-26T23:26:02', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Вот Лайф саме норм'}, {'id': 237, 'type': 'message', 'date': '2018-12-26T23:26:09', 'edited': '2018-12-26T23:26:12', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Але ловить краще київ'}, {'id': 238, 'type': 'message', 'date': '2018-12-26T23:29:58', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'text': 'то же саме'}, {'id': 239, 'type': 'message', 'date': '2018-12-26T23:30:09', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'file': '(File not included. Change data exporting settings to download.)', 'media_type': 'voice_message', 'mime_type': 'audio/ogg', 'duration_seconds': 4, 'text': ''}, {'id': 240, 'type': 'message', 'date': '2018-12-26T23:31:09', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Ладно, сонце'}, {'id': 241, 'type': 'message', 'date': '2018-12-26T23:31:11', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Я спатки'}, {'id': 242, 'type': 'message', 'date': '2018-12-26T23:31:19', 'edited': '2018-12-26T23:31:21', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'До завтра, солодких'}, {'id': 243, 'type': 'message', 'date': '2018-12-26T23:31:33', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'text': 'солодких)'}, {'id': 244, 'type': 'message', 'date': '2018-12-26T23:31:40', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'text': 'завтра зустрінемось)'}, {'id': 245, 'type': 'message', 'date': '2018-12-26T23:33:30', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'photo': '(File not included. Change data exporting settings to download.)', 'width': 720, 'height': 1280, 'text': ''}, {'id': 246, 'type': 'message', 'date': '2018-12-26T23:33:30', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'photo': '(File not included. Change data exporting settings to download.)', 'width': 720, 'height': 1280, 'text': ''}, {'id': 247, 'type': 'message', 'date': '2018-12-26T23:39:13', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'text': 'Це так мило'}, {'id': 248, 'type': 'message', 'date': '2018-12-26T23:39:45', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'text': 'Атаман вже мені пише'}, {'id': 249, 'type': 'message', 'date': '2018-12-26T23:50:51', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Оце тако'}, {'id': 253, 'type': 'message', 'date': '2018-12-26T23:51:24', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'І шо хоче?'}, {'id': 301, 'type': 'message', 'date': '2018-12-26T23:58:33', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'file': '(File not included. Change data exporting settings to download.)', 'media_type': 'voice_message', 'mime_type': 'audio/ogg', 'duration_seconds': 38, 'text': ''}, {'id': 302, 'type': 'message', 'date': '2018-12-26T23:58:41', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'file': '(File not included. Change data exporting settings to download.)', 'media_type': 'voice_message', 'mime_type': 'audio/ogg', 'duration_seconds': 7, 'text': ''}, {'id': 303, 'type': 'message', 'date': '2018-12-26T23:58:49', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'file': '(File not included. Change data exporting settings to download.)', 'media_type': 'voice_message', 'mime_type': 'audio/ogg', 'duration_seconds': 2, 'text': ''}, {'id': 306, 'type': 'message', 'date': '2018-12-26T23:59:33', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Бубубу'}, {'id': 307, 'type': 'message', 'date': '2018-12-26T23:59:47', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Хачу цьом наніч'}, {'id': 313, 'type': 'message', 'date': '2018-12-27T00:00:35', 'edited': '2018-12-27T00:00:39', 'from': 'Лена', 'from_id': 315536481, 'text': 'Цьом'}, {'id': 314, 'type': 'message', 'date': '2018-12-27T00:00:41', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'text': 'Всьо'}, {'id': 316, 'type': 'message', 'date': '2018-12-27T00:00:44', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'text': 'Спи'}, {'id': 318, 'type': 'message', 'date': '2018-12-27T00:00:49', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'text': 'Тобі рано вставати'}, {'id': 320, 'type': 'message', 'date': '2018-12-27T00:01:00', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'file': '(File not included. Change data exporting settings to download.)', 'media_type': 'voice_message', 'mime_type': 'audio/ogg', 'duration_seconds': 6, 'text': ''}, {'id': 328, 'type': 'message', 'date': '2018-12-27T00:02:20', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Якась вона у тебе буйна)'}, {'id': 329, 'type': 'message', 'date': '2018-12-27T00:02:25', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'reply_to_message_id': 313, 'text': 'Гадица'}, {'id': 330, 'type': 'message', 'date': '2018-12-27T00:03:05', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'text': 'Ага вночі особливо'}, {'id': 332, 'type': 'message', 'date': '2018-12-27T00:03:09', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'text': '😴'}, {'id': 333, 'type': 'message', 'date': '2018-12-27T00:03:12', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'text': 'Солодких'}, {'id': 346, 'type': 'message', 'date': '2018-12-27T00:04:23', 'edited': '1970-01-01T02:00:00', 'from': 'Denis Semenov', 'from_id': 560994053, 'text': 'Добраніч)'}, {'id': 1498, 'type': 'message', 'date': '2019-03-18T18:16:27', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'forwarded_from': 'Anna', 'photo': '(File not included. Change data exporting settings to download.)', 'width': 960, 'height': 1280, 'text': ''}, {'id': 1499, 'type': 'message', 'date': '2019-03-18T18:16:27', 'edited': '1970-01-01T02:00:00', 'from': 'Лена', 'from_id': 315536481, 'forwarded_from': 'Anna', 'photo': '(File not included. Change data exporting settings to download.)', 'width': 960, 'height': 1280, 'text': ''}]}
#      print(l)
#      l["messages"] = list(map(lambda x: give_emoji_free_text(x), l["messages"]))
#      print(l)
